!function(a,b){"use strict";function c(b){a.addEventListener("load",function(){new c.Engine(b)})}a.j5g3=c,c.extend=function(a,b){for(var c in b)a[c]=b[c]},c.extend(c,{Class:function(a){this.extend(a)},factory:function(a){return function(b){return new a(b)}},id:function(a){return b.getElementById(a)},ready:function(b){a.addEventListener("load",b,!1)},dom:function(a){return b.createElement(a)}}),c.dom.src=function(a,c){var d=b.createElement(a);return d.setAttribute("src",c),d},c.dom.image=function(a){return c.dom.src("img",a)},c.Class.extend=function(a,b){var d,e,f=this,g=a.init||function(){f.apply(this,arguments)},h=function(){};h.prototype=f.prototype,g.prototype=new h,g.extend=c.Class.extend;for(d in a)a.hasOwnProperty(d)&&(e=Object.getOwnPropertyDescriptor(a,d),Object.defineProperty(g.prototype,d,e));for(d in b)b.hasOwnProperty(d)&&(e=Object.getOwnPropertyDescriptor(b,d),Object.defineProperty(g,d,e));return g},c.Class.prototype.extend=function(a){for(var b in a)this[b]=a[b]}}(this,this.document),function(a,b,c){"use strict";function d(a,c){do{if(null!==a[c])return a[c];if(a instanceof b.Stage)break}while(a=a.parent)}var e=b.dom("CANVAS"),f=b.factory;b.extend(b,{rand:function(a){return Math.random()*a},irand:function(a){return Math.random()*a|0},ary:function(a,b,c){var d,e=[];if(b)for(;b--;)for(e[b]=[],d=0;a>d;d++)e[b][d]=c;else for(;a--;)e.push(c);return e},canvas:function(a,c){var d=b.dom("CANVAS");return d.setAttribute("width",a),d.setAttribute("height",c),d},get_type:function(c){var d=typeof c;if("object"===d){if(null===c)return"null";if(c instanceof Array)return"array";if(c instanceof b.Class)return"j5g3";if(c instanceof a.HTMLElement)return"dom";if(c instanceof a.Image)return"dom";if(c instanceof a.HTMLAudioElement)return"audio"}return d},gradient:function(a,b,c,d){return e.getContext("2d").createLinearGradient(a,b,c,d)},rgba:function(a,b,d,e){return e===c&&(e=1),"rgba("+a+","+b+","+d+","+e+")"},hsla:function(a,b,d,e){return e===c&&(e=1),"hsla("+a+","+b+"%,"+d+"%,"+e+")"}}),b.Draw={Void:function(){},Default:function(a){this.begin(a),this.paint(a),this.end(a)},NoTransform:function(a){this.paint(a)},Root:function(){var a=this.context;a.clearRect(0,0,this.width,this.height),this.begin(a),this.paint(a),this.end(a),this.screen.clearRect(0,0,this.width,this.height),this.screen.drawImage(this.renderCanvas,0,0)},RootDirty:function(){var a=this,b=this.context,c=a._dx,d=a._dw,e=a._dy,f=a._dh;0!==d&&0!==f&&(b.clearRect(c,e,d,f),a.begin(b),a.paint(b),a.end(b),a.screen.clearRect(c,e,d,f),a.screen.drawImage(a.renderCanvas,c,e,d,f,c,e,d,f),a._dx=a._dy=null,a._dh=a._dw=0)},RootDirect:function(){var a=this.context;this.clearRect(0,0,this.canvas.width,this.canvas.height),this.begin(a),this.paint(a),this.end(a)},FastImage:function(a){a.drawImage(this.source,this.x+this.cx,this.y+this.cy)},Cache:function(a){a.drawImage(this._cache_source,0,0,this.width,this.height,this.x+this.cx,this.y+this.cy,this.width,this.height)}},b.Paint={Image:function(a){a.drawImage(this.source,this.cx,this.cy)},ImageScaled:function(a){a.drawImage(this.source,this.cx,this.cy,this.width,this.height)},Sprite:function(a){var b=this.source;a.drawImage(b.image,b.x,b.y,b.w,b.h,this.cx,this.cy,this.width,this.height)},Container:function(a){var b=this.frame,c=b;for(a.translate(this.cx,this.cy);(c=c._next)!==b;)c.draw(a)},Text:function(a){a.fillText(this.text,this.cx,this.cy)},MultilineText:function(a){for(var b=this.text.split("\n"),c=0,d=b.length,e=0;d>c;c++)a.fillText(b[c],this.cx,this.cy+e),e+=this.line_height},TextStroke:function(a){a.strokeText(this.text,this.cx,this.cy)},TextStrokeFill:function(a){a.fillText(this.text,this.cx,this.cy),a.strokeText(this.text,this.cx,this.cy)},Map:function(a){var b,c,d,e=this.map,f=e.length,g=this.sprites;for(a.translate(this.cx,this.cy+f*this.th);f--;)for(b=e[f].length,d=e[f],a.translate(b*this.tw,-this.th);b--;)a.translate(-this.tw,0),(c=g[d[b]])&&c.draw(a)},Isometric:function(a){var b,c,d,e,f=this.map,g=0,h=f.length,i=this.sprites,j=(this.tw/2|0)+this.offsetX,k=(this.th/2|0)+this.offsetY;for(a.translate(this.cx,this.cy-k),d=j;h>g;g++)for(b=f[g].length,c=f[g],d=-d,a.translate(b*this.tw-d,k);b--;)a.translate(-this.tw,0),(e=i[c[b]])&&e.draw(a)}},b.Cache={Canvas:function(a,c){var d,e=this,f=b.dom("CANVAS");return f.width=a||e.width,f.height=c||e.height,d=f.getContext("2d",!1),d.translate(-e.x-e.cx,-e.y-e.cy),e.clear_cache(),e.draw(d),e._cache_source=f,e._oldPaint=e.draw,e.draw=b.Draw.Cache,this},use:function(a,b){return a(b,e.getContext("2d"))}},b.HitTest={Void:function(){return!1},Circle:function(a,b,c){return c=c?c.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y),c.to_client(a,b),c.x*c.x+c.y*c.y<=this.radius*this.radius?this:!1},Container:function(a,b,c){var d,e=this.frame,f=e;for(c=c?c.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y);(f=f._previous)!==e&&!(d=f.at(a,b,c)););return d},Rect:function(a,b,c){return c=c?c.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y),c.to_client(a,b),c.x>0&&c.x<this.width&&c.y>0&&c.y<this.height?this:!1},Polygon:function(a,b,c){var d,e=this.points,f=this.normals,g=0,h=e.length;for(c=c?c.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y),c.to_client(a,b);h>g;g+=2)if(d=f[g]*(c.x-e[g])+f[g+1]*(c.y-e[g+1]),d>0)return!1;return this}},b.MatrixLite=b.Class.extend({a:1,b:0,c:0,d:1,_cos:1,_sin:0,scaleX:1,scaleY:1,init:function(a,b,d,e){a!==c&&(this.a=a,this.b=b,this.c=d,this.d=e)},setRotation:function(a){return this._cos=Math.cos(a),this._sin=Math.sin(a),this.calc4()},setScaleX:function(a){return this.scaleX=a,this.calc4()},setScaleY:function(a){return this.scaleY=a,this.calc4()},scale:function(a,b){return this.scaleX=a,this.scaleY=b,this.calc4()},calc4:function(){return this.a=this.scaleX*this._cos,this.b=this.scaleX*this._sin,this.c=-this.scaleY*this._sin,this.d=this.scaleY*this._cos,this},to_m:function(a,c){return new b.Matrix(this.a,this.b,this.c,this.d,a||0,c||0)}}),b.Matrix=b.Class.extend({a:1,b:0,c:0,d:1,e:0,f:0,init:function(a,b,d,e,f,g){a!==c&&(this.a=a,this.b=b,this.c=d,this.d=e,this.e=f,this.f=g)},translate:function(a,b){this.e+=a,this.f+=b},multiply:function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.c,j=this.d;return this.a=g*a+i*b,this.b=h*a+j*b,this.c=g*c+i*d,this.d=h*c+j*d,this.e+=g*e+i*f,this.f+=h*e+j*f,this},clone:function(){return b.matrix().multiply(this.a,this.b,this.c,this.d,this.e,this.f)},inverse:function(){var a=this.clone(),b=this.a*this.d-this.b*this.c;return a.a=this.d/b,a.b=this.b/-b,a.c=this.c/-b,a.d=this.a/b,a.e=(this.d*this.e-this.c*this.f)/-b,a.f=(this.b*this.e-this.a*this.f)/b,a},product:function(a,b,c){return this.clone().multiply(a.a,a.b,a.c,a.d,a.e||b||0,a.f||c||0)},reset:function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},to_world:function(a,b){return this.x=this.a*a+this.c*b+this.e,this.y=this.b*a+this.d*b+this.f,this},to_client:function(a,b){var c=this.a*this.d-this.b*this.c;return this.x=(this.d*a-this.c*b+this.c*this.f-this.d*this.e)/c,this.y=(-this.b*a+this.a*b+this.b*this.e-this.a*this.f)/c,this}}),b.DisplayObject=b.Class.extend({source:null,_next:null,_previous:null,parent:null,M:null,x:0,y:0,cx:0,cy:0,width:null,height:null,_rotation:0,set rotation(a){this.M.setRotation(this._rotation=a)},get rotation(){return this._rotation},set sx(a){this.M.setScaleX(a)},get sx(){return this.M.scaleX},set sy(a){this.M.setScaleY(a)},get sy(){return this.M.scaleY},alpha:1,blending:null,stroke:null,fill:null,font:null,line_width:null,line_cap:null,line_join:null,miter_limit:null,dirty:!0,init:function(a){this.M=new b.MatrixLite,this.extend(a)},begin:function(a){var b=this,c=this.M;a.save(),1!==b.alpha&&(a.globalAlpha*=b.alpha),null!==b.fill&&(a.fillStyle=b.fill),null!==b.stroke&&(a.strokeStyle=b.stroke),null!==b.font&&(a.font=b.font),null!==b.blending&&(a.globalCompositeOperation=b.blending),null!==b.line_width&&(a.lineWidth=b.line_width),null!==b.line_cap&&(a.lineCap=b.line_cap),null!==b.line_join&&(a.lineJoin=b.line_join),null!==b.miter_limit&&(a.miterLimit=b.miter_limit),a.transform(c.a,c.b,c.c,c.d,b.x,b.y)},end:function(a){a.restore()},draw:b.Draw.Default,_paint:null,invalidate:function(){this.parent.invalidate(this)},update:null,remove:function(){return this.parent&&(this._previous._next=this._next,this._next._previous=this._previous,this.parent=this._previous=null),this},align:function(a,b){switch(b=b||this.parent,a){case"center":this.x=b.width/2;break;case"left":this.x=0;break;case"right":this.x=b.width-this.width;break;case"middle":this.y=b.height/2;break;case"center middle":this.pos(b.width/2,b.height/2);break;case"origin":this.pos(-this.width/2,-this.height/2);break;case"origin top":this.pos(-this.width/2,-this.height);break;case"origin bottom":this.pos(-this.width/2,0)}return this},pos:function(a,b){return this.x=a,this.y=b,this},size:function(a,b){return this.width=a,this.height=b,this},move:function(a,b){return this.x+=a,this.y+=b,this},visible:function(){return this.alpha>0},stretch:function(a,b){return this.scale(a/this.width,b/this.height)},to_clip:function(){return b.clip({width:this.width,height:this.height}).add(this)},cache:b.Cache.Canvas,clear_cache:function(){this._oldPaint&&(this.draw=this._oldPaint)},set:function(a){return this.extend(a),this},at:b.HitTest.Rect,scale:function(b,c){return a.isNaN(b)||(this.sx=b),a.isNaN(c)||(this.sy=c),this},rotate:function(a){return this.rotation+=a,this}}),b.Image=b.DisplayObject.extend({init:function(a){switch(b.get_type(a)){case"string":a={source:b.id(a)};break;case"dom":a={source:a}}b.DisplayObject.call(this,a),this.source&&this.set_source(this.source)},paint:b.Paint.Image,_get_source:function(a){return"string"==typeof a?b.id(a):a},set_source:function(a){this.source=this._get_source(a),null===this.width&&(this.width=this.source.naturalWidth||this.source.width),null===this.height&&(this.height=this.source.naturalHeight||this.source.height)}}),b.Text=b.DisplayObject.extend({text:"",line_height:null,_align:null,align_text:function(a){var b=this.measure();return"left"===a?this.cx=0:"center"===a?this.cx=-b/2:"right"===a&&(this.cx=-b),this},init:function(a){"string"==typeof a&&(a={text:a}),b.DisplayObject.call(this,a),null===this.line_height&&this.measure()},_paint:b.Paint.Text,paint:b.Paint.Text,_measure:function(a,b){var c,e=(""+a.text).split("\n"),f=e.length,g=0,h=d(a,"font");for(a.begin(b),h&&(b.font=h);f--;)c=b.measureText(e[f]),c.width>g&&(g=c.width);return null===a.line_height&&(a.line_height=parseInt(b.font,10)),a.end(b),g},_begin:b.DisplayObject.prototype.begin,begin:function(a){a.textBaseline="top",this._begin(a)},measure:function(){return b.Cache.use(this._measure,this)}}),b.Html=b.DisplayObject.extend({html:"",init:function(a){"string"==typeof a&&(a={html:b.dom(a).innerHTML}),b.DisplayObject.apply(this,[a])}}),b.Clip=b.DisplayObject.extend({_frames:null,_frame:0,length:null,playing:!0,st:1,init:function(a){b.DisplayObject.call(this,a),this._frames=[],this.add_frame(),null!==this.setup&&this.setup()},invalidate:function(a){this.parent.invalidate(a||this)},setup:null,update:function(){var a=this.frame,b=a;for(this.update_frame&&this.update_frame();(b=b._next)!==a;)null!==b.update&&b.update();this.playing&&((this._frame+=this.st)>=this.length&&(this._frame=0),this.frame=this._frames[0|this._frame])},frame:null,paint:b.Paint.Container,stop:function(){return this.playing=!1,this},play:function(){return this.playing=!0,this},add:function(a){switch(b.get_type(a)){case"function":a=new b.Action(a);break;case"string":a=new b.Image({source:a});break;case"array":for(var c=0;c<a.length;c++)this.add(a[c]);return this;case"audio":break;case"dom":case"object":a=new b.Image(a);break;case"undefined":case"null":throw"Trying to add undefined object to clip."}return this.add_object(a)},add_object:function(a){var b=this.frame;return a.parent&&a.remove(),b._previous._next=a,a._previous=b._previous,a._next=b,a.parent=this,b._previous=a,this},add_frame:function(a){var b={};return b._previous=b._next=b,this._frames.push(b),this.go((this.length=this._frames.length)-1),a?this.add(a):this},is_frame_empty:function(){return this.frame._next===this.frame},remove_frame:function(a){return a=a===c?this._frame:a,this._frames.splice(a,1),this.go(a>0?a-1:0),this.length=this._frames.length,this},go:function(a){return this.frame=this._frames[this._frame=a],this},each:function(a){for(var b,c,d=this._frames.length;d--;)for(c=b=this._frames[d];(c=c._next)!==b;)a(c);return this},each_pair:function(a){for(var b,c=this.frame,d=c;(d=b=d._next)!==c;)for(;(b=b._next)!==c;)a(d,b)},align_children:function(a){return this.each(function(b){b.align&&b.align(a)})},at:b.HitTest.Container}),b.Stage=b.Clip.extend({canvas:null,context:null,screen:null,renderCanvas:null,smoothing:!1,background:!1,container:!1,_dx:0,_dy:0,_dw:0,_dh:0,_init_container:function(){if(this.container===!1)return this.container=a.document.body,this.container;if("dom"===b.get_type(this.container))return this.container;var c=this.container=b.dom("DIV");return c.className="j5g3-stage",a.document.body.appendChild(c),c},_init_canvas:function(){var a=this._init_container();this.canvas||(this.canvas=b.canvas(this.width,this.height),this.background?a.insertBefore(this.canvas,a.firstChild):a.appendChild(this.canvas)),this.renderCanvas=b.dom("CANVAS")},_init_context:function(){var a=this;a.context=a.renderCanvas.getContext("2d"),a.screen=a.canvas.getContext("2d")},init:function(a){var c=this;b.Clip.call(c,a),c._init_canvas(),c.resolution(c.width||c.canvas.clientWidth||640,c.height||c.canvas.clientHeight||480),c._init_context()},layer:function(a){var c,d;return"string"==typeof a&&(a={canvas:b.id(a)}),b.extend(d={width:this.width,height:this.height,container:this.container},a),c=new b.Stage(d),c.draw=b.Draw.RootDirty,this.add(c),c},invalidate:function(a){if(a===c)return this._dx=this._dy=0,this._dh=this.height,this._dw=this.width,void 0;var b=a.x+a.cx,d=a.y+a.cy;null===this._dx?this._dx=b:b<this._dx&&(this._dw+=this._dx-b,this._dx=b),null===this._dy&&(this._dy=d),d<this._dy&&(this._dh+=this._dy-d,this._dy=d),b+a.width>this._dx+this._dw&&(this._dw=b+a.width-this._dx,this._dx+this._dw>this.width&&(this._dw=this.width-this._dx)),d+a.height>this._dy+this._dh&&(this._dh=d+a.height-this._dy,this._dy+this._dh>this.height&&(this._dh=this.height-this._dy))},resolution:function(a,b){if(0===a||0===b)throw new Error("Invalid stage resolution: "+a+"x"+b);return this._dw=this.canvas.width=this.renderCanvas.width=a,this._dh=this.canvas.height=this.renderCanvas.height=b,this.size(a,b)},draw:b.Draw.Root}),b.Tween=b.DisplayObject.extend({auto_remove:!1,repeat:1/0,duration:100,from:null,target:null,to:null,t:0,on_stop:null,on_remove:null,init:function(a){a instanceof b.Class&&(a={target:a}),this.update=this.start,b.DisplayObject.apply(this,[a])},draw:b.Draw.Void,pause:function(){return this._olddraw=this.update,this.update=null,this},resume:function(){return this.update=this._olddraw?this._olddraw:this.start,this},rewind:function(){return this.repeat-=1,this.t=0,this.vf=0,this},restart:function(){return this.t=0,this.stop().start()},stop:function(){return this.pause().rewind(),this.on_stop&&this.on_stop(),this},easing:function(a){return a},apply_tween:function(a,b){return this.from[a]+this.easing(b)*(this.to[a]-this.from[a])},_remove:b.DisplayObject.prototype.remove,remove:function(){this.on_remove&&this.on_remove(),this._remove()},_calculate:function(){var a,b=this,c=b.target;b.duration===b.t&&(b.vf=1);for(a in b.to)c[a]=b.apply_tween(a,b.vf);b.t<b.duration?(b.t++,b.vf+=b.v):b.auto_remove?b.remove():b.repeat?b.rewind():b.stop()},start:function(){var a,b=this,c=b.to,d=b.target;if(null===b.from){b.from={};for(a in c)b.from[a]=d[a]}return b.v=1/b.duration,b.vf=0,b.update=b._calculate,this},at:b.HitTest.Void}),b.Sprite=b.DisplayObject.extend({init:function(a){if(b.DisplayObject.call(this,a),!this.source)throw new Error("Invalid source property for Sprite");null===this.width&&(this.width=this.source.w),null===this.height&&(this.height=this.source.h)},paint:b.Paint.Sprite}),b.Spritesheet=b.Class.extend({width:null,height:null,_sprites:null,init:function(a){switch(b.get_type(a)){case"string":case"dom":case"j5g3":a={source:a}}b.Class.call(this,a)},set source(a){var c;switch(b.get_type(a)){case"string":case"dom":c=new b.Image(a);break;default:c=a}if(!c)throw new Error("Invalid source for Spritesheet.");null===this.width&&c&&(this.width=c.width),null===this.height&&c&&(this.height=c.height),this._source=c,this._sprites=[]},get source(){return this._source},select:function(a){var b=[];return this.each(a,function(a){b.push(a)}),b},each:function(a,b){for(var c=0,d=a.length;d>c;c++)b(this.sprite(a[c]));return this},clip:function(a){var c=b.clip().remove_frame(),d=0,e=0;return this.each(a,function(a){c.add_frame(a),a.width>d&&(d=a.width),a.height>e&&(e=a.height)}),c.size(d,e).go(0)},push:function(a,b,c,d){return this.slice(a,b,c,d),this},slice:function(a,b,c,d){return this._sprites.push({width:c,height:d,source:{image:this.source.source,x:a,y:b,w:c,h:d}})-1},cut:function(a,b,c,d){return this.sprite(this.slice(a,b,c,d))},grid:function(a,b,c){c=c||0;var d,e,f=2*c,g=this.width/a-f|0,h=this.height/b-f|0;for(d=0;b>d;d++)for(e=0;a>e;e++)this.slice(e*(g+f)+c,d*(h+f)+c,g,h);return this},sprite:function(a){return new b.Sprite(this._sprites[a])},sprites:function(){for(var a=0,b=this._sprites.length,c=[];b>a;a++)c.push(this.sprite(a));return c},map:function(a,c){return new b.Map({sprites:this.sprites(),tw:a,th:c})}}),b.Emitter=b.Clip.extend({init:function(a){b.Clip.apply(this,[a])},source:b.Clip,container_update:function(){this._life--?null!==this._emitter_update&&this._emitter_update():this.remove()},life:10,on_emit:null,count:1,spawn:function(){var a=new this.source;return a._life=this.life,a._emitter_update=a.update,a.update=this.container_update,a},_emit:function(){var a=this.spawn();this.add_object(a),this.on_emit&&this.on_emit(a)},update_frame:function(){for(var a=this.count;a--;)this._emit()}}),b.Map=b.DisplayObject.extend({sprites:null,map:null,tw:0,th:0,offsetX:0,offsetY:0,init:function(a){b.DisplayObject.apply(this,[a]),null===this.map&&(this.map=[])},to_iso:function(a,b){var c=this,d=(this.tw/2|0)+this.offsetX,e=(this.th/2|0)+this.offsetY,f=b%2?0:-d,g=(a*c.tw-f|0)-this.cx,h=(b*e|0)-this.cy;return{x:g,y:h}},paint:b.Paint.Map}),b.Action=b.Class.extend({_init:b.Class,update:null,draw:b.Draw.Void,init:function(a){"function"===b.get_type(a)&&(a={update:a}),this._init(a)},remove:b.DisplayObject.prototype.remove},{rotate:function(a){return function(){a.rotation=a.rotation<6.1?a.rotation+.1:0}}}),b.Engine=b.Class.extend({version:"0.9.0",__fps:31,_renderLoopFn:null,_gameLoopFn:null,_renderLoopId:0,_gameLoopId:0,paused:!0,run:function(){var b=this;return b.clear_process(),b._renderLoopFn=function(){b._renderLoop()},b._renderLoop(),b._gameLoopFn=function(){b._gameLoop()},b._gameLoopId=a.setInterval(b._gameLoopFn,b.__fps),b.paused=!1,b},clear_process:function(){a.clearInterval(this._gameLoopId),a.cancelAnimationFrame(this._renderLoopId)},destroy:function(){this.pause(),this.on_destroy&&this.on_destroy()},_renderLoop:function(){this.stage.draw(),this._renderLoopId=a.requestAnimationFrame(this._renderLoopFn)},_gameLoop:function(){this.stage.update()},startFn:function(){},init:function(d){var f=this;"function"==typeof d&&(d={startFn:d}),d===c&&(d={}),e.style.display="none",e.setAttribute("id","j5g3-cache"),a.document.body.appendChild(e),b.Class.apply(f,[d]),f.stage_settings||(f.stage_settings={}),f.stage_settings.canvas||(f.stage_settings.canvas=b.id("screen")),f.stage||(f.stage=new b.Stage(f.stage_settings)),f.startFn(b,f)},pause:function(){this.clear_process(),this._renderLoopFn=function(){},this.paused=!0},resume:function(){this.paused&&this.run()},set fps(a){this.__fps=1e3/a},get fps(){return 1e3/this.__fps},imagedata:function(a,c){var d,f;switch(b.get_type(a)){case"string":d=b.id(a);break;case"dom":d=a;break;case"j5g3":d=a.source}return d?(e.width=d.width,e.height=d.height,f=e.getContext("2d"),f.drawImage(d,0,0),f.getImageData(0,0,d.width,d.height)):this.stage.context.createImageData(a||this.stage.canvas.width,c||this.stage.canvas.height)}}),b.Easing=function(){var a,b={},c={},d=function(a,b){c["EaseIn"+a]=b,c["EaseOut"+a]=function(a){return 1-b(1-a)},c["EaseInOut"+a]=function(a){return.5>a?b(2*a)/2:b(-2*a+2)/-2+1}};["Quad","Cubic","Quart","Quint","Expo"].forEach(function(a,c){b[a]=function(a){return Math.pow(a,c+2)}}),b.Sine=function(a){return 1-Math.cos(a*Math.PI/2)},b.Circ=function(a){return 1-Math.sqrt(1-a*a)},b.Elastic=function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},b.Back=function(a){return a*a*(3*a-2)},b.Bounce=function(a){for(var b,c,d=4;a<((b=Math.pow(2,--d))-1)/11;);return c=1/Math.pow(4,3-d)-7.5625*Math.pow((3*b-2)/22-a,2)};for(a in b)d(a,b[a]);return c.Linear=function(a){return a},c.Swing=function(a){return-Math.cos(a*Math.PI)/2+.5},c}(),b.action=f(b.Action),b.clip=f(b.Clip),b.image=f(b.Image),b.sprite=f(b.Sprite),b.spritesheet=f(b.Spritesheet),b.text=f(b.Text),b.stage=f(b.Stage),b.mtext=function(a){var c=new b.Text(a);return c.paint=b.Paint.MultilineText,c},b.sftext=function(a){var c=new b.Text(a);return c.paint=b.Paint.TextStrokeFill,c},b.matrix=function(a,c,d,e,f,g){return new b.Matrix(a,c,d,e,f,g)},b.tween=f(b.Tween),b.emitter=f(b.Emitter),b.map=f(b.Map),b.html=f(b.Html),b.engine=f(b.Engine)}(this,this.j5g3),function(a,b){b.Loader=b.Class.extend({EVENT:{IMG:"load",AUDIO:"canplaythrough",SCRIPT:"load"},sources:null,delay:250,progress:0,start:null,length:0,on_progress:null,on_source:null,on_ready:null,init:function(a){b.Class.apply(this,[a]),this.sources={},this.start=new Date},_check_ready:function(){var b,c=0,d=0,e=this;for(b in this.sources)d++,this.sources.hasOwnProperty(b)&&this.sources[b].ready&&c++;this.progress=c?c/d:0,this.on_progress&&this.on_progress(this.progress),d===c?this.on_ready&&this.on_ready():this._timeout=a.setTimeout(function(){e._check_ready()},this.delay)},el:function(c,d){var e,f=this,g=this.sources[d];return g?g=g.el:(g=b.dom(c),this.sources[d]=e={el:g},g.addEventListener(this.EVENT[c],function(){e.ready=!0,f.on_source&&f.on_source(e)},!1),g.addEventListener("error",function(){e.ready=!0,a.console.warn("Could not load asset: "+d)},!1),g.setAttribute("src",d),this.length++),g},img:function(a){return this.el("IMG",a)},audio:function(a){var c=a.split(".").pop();return b.support.audio[c]||(a=a.replace(new RegExp("\\."+c+"$"),"."+b.support.audio.preferred)),this.el("AUDIO",a)},data:function(b,c){var d=this,e=new a.XMLHttpRequest,f=this.sources[b];return f||(f=this.sources[b]={source:b,request:e},e.onreadystatechange=function(){4===e.readyState&&(f.ready=!0,f.raw=e.responseText,c&&c(f),d.on_source&&d.on_source(e))},e.open("GET",b),e.send()),f},json:function(a){return this.data(a,function(a){a.json=JSON.parse(a.raw)})},script:function(b){var c=this.el("SCRIPT",b);return a.document.head.appendChild(c),c},ready:function(a){a&&(this.on_ready=a),this._check_ready()},destroy:function(){a.clearTimeout(this._timeout)}}),b.loader=b.factory(b.Loader)}(this,this.j5g3),function(a){"use strict";a.Collision=a.Class.extend({A:null,B:null,nx:0,ny:0,penetration:0,length:0,tx:0,ty:0,0:null,1:null,2:null,3:null,4:null,5:null,6:null,query:null}),a.Collision.Circle=a.Collision.extend({query:function(a,b){var c=a.radius+b.radius,d=a.x+a.radius+a.cx,e=a.y+a.radius+a.cy,f=d-b.radius-b.cx-b.x,g=e-b.radius-b.cy-b.y,h=f*f+g*g,i=this;return(i.collides=c*c>h)?(h=Math.sqrt(h),i.A=a,i.B=b,i.nx=f/h,i.ny=g/h,i.penetration=c-h,i[0]=d-f/2,i[1]=e-g/2,!0):void 0}}),a.Collision.AABB=a.Collision.extend({query:function(a,b){var c,d,e=a.x+a.cx,f=b.x+b.cx,g=a.y+a.cy,h=b.y+b.cy,i=e+a.width,j=f+b.width,k=g+a.height,l=h+b.height,m=this;return m.collides=!(f>=i||e>=j||h>=k||g>=l),m.collides?(m.B=b,c=m.tx=j/2-i/2,d=m.ty=l/2-k/2,m[0]=Math.max(e,f),m[1]=Math.max(g,h),m[2]=Math.min(i,j),m[3]=Math.min(k,l),m[2]-m[0]<m[3]-m[1]?(m.nx=0>c?-1:1,m.ny=0,m.penetration=0>c?m[2]-e:i-m[0]):(m.ny=0>d?-1:1,m.nx=0,m.penetration=0>d?m[3]-g:k-m[1]),this):void 0}}),a.CollisionTest={Circle:function(a){var b=this,c=b.radius+a.radius,d=b.x+b.radius+b.cx,e=b.y+b.radius+b.cy,f=d-a.radius-a.cx-a.x,g=e-a.radius-a.cy-a.y;return c*c>f*f+g*g},AABB:function(a){var b=this.x+this.width,c=this.y+this.height,d=a.x+a.width,e=a.y+a.height;return!(a.x>b||d<this.x||a.y>c||e<this.y)},Container:function(a){for(var b=this.frame,c=b,d=!1,e={x:a.x-this.x,y:a.y-this.y,width:a.width,height:a.height};(c=c._previous)!==b&&!(d=c.collides&&c.collides(e)););return d}},a.DisplayObject.prototype.collides=a.CollisionTest.AABB,a.Clip.prototype.collides=a.CollisionTest.Container}(this.j5g3),function(a,b){"use strict";a.Shape=a.DisplayObject.extend({shape:null,red:b,green:b,blue:b,color_property:"fill",_red:b,_green:b,_blue:b,line_width:null,init:function(b){a.DisplayObject.apply(this,[b])},_begin:a.DisplayObject.prototype.begin,begin:function(a){var b=this;(b.red!==b._red||b.blue!==b._blue||b.green!==b._green)&&(b[b.color_property]="rgb("+Math.floor(b.red)+","+Math.floor(b.green)+","+Math.floor(b.blue)+")",b._red=b._red,b._green=b.green,b._blue=b.blue),this._begin(a)},paintPath:function(){},paint:function(a){a.beginPath(),this.paintPath(a),a.closePath(),a.fill(),a.stroke()}}),a.Circle=a.Shape.extend({shape:"circle",radius:0,init:function(b){"number"==typeof b&&(b={radius:b}),a.Shape.apply(this,[b])},paintPath:function(a){a.arc(this.radius+this.cx,this.radius+this.cy,this.radius,0,2*Math.PI,!1)},at:a.HitTest.Circle}),a.Line=a.Shape.extend({x2:0,y2:0,paintPath:function(a){a.moveTo(this.cx,this.cy),a.lineTo(this.x2,this.y2)}}),a.Polygon=a.Shape.extend({shape:"polygon",points:null,normals:null,init:function(b){a.Shape.apply(this,[b]),null===this.points&&(this.points=[]),null===this.normals&&this.calculate_normals()},normalize:function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return a[0]=a[0]/b,a[1]=a[1]/b,a},calculate_normals:function(){for(var a,b=0,c=this.points,d=c.length,e=[],f=[0,0];d>b;b+=2)a=d>b+2?b+2:0,f[0]=c[a]-c[b],f[1]=c[a+1]-c[b+1],this.normalize(f),e.push(f[1],-f[0]);this.normals=e},paintPath:function(a){var b=2,c=this.points,d=c.length;for(a.moveTo(c[0],c[1]);d>b;b+=2)a.lineTo(c[b],c[b+1])},at:a.HitTest.Polygon},{create:function(b,c){var d=2*Math.PI/b,e=d;for(c.points=[];b--;)c.points.push(Math.cos(e)*c.radius,Math.sin(e)*c.radius),e+=d;return new a.Polygon(c)}}),a.Rect=a.Shape.extend({shape:"polygon",init:function(b){a.Shape.apply(this,[b]),null===this.width&&(this.height=this.width=2*this.radius)},paint:function(a){a.fillRect(this.cx,this.cy,this.width,this.height),a.strokeRect(this.cx,this.cy,this.width,this.height)}}),a.Dot=a.Shape.extend({shape:"circle",line_cap:"round",line_join:"round",color_property:"stroke",init:function(b){"number"==typeof b&&(b={line_width:b}),a.Shape.apply(this,[b])},paint:function(a){a.strokeRect(0,0,1,1)}}),a.polygon=a.factory(a.Polygon),a.circle=a.factory(a.Circle),a.line=a.factory(a.Line),a.dot=a.factory(a.Dot),a.rect=a.factory(a.Rect)}(this.j5g3),function(a,b){"use strict";var c=b.dom("audio"),d=["wav","mp3","ogg"],e=["audio/wav","audio/mpeg","audio/ogg"];Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}}),a.HTMLAudioElement||(a.HTMLAudioElement=a.Audio),a.requestAnimationFrame||(a.requestAnimationFrame=a.mozRequestAnimationFrame||a.msRequestAnimationFrame||function(b){return a.setTimeout(b,1e3/60)}),a.cancelAnimationFrame||(a.cancelAnimationFrame=a.mozCancelAnimationFrame||a.msCancelAnimationFrame||function(b){a.clearTimeout(b)}),b.support={audio:{},touch:"ontouchstart"in a.document},c&&c.canPlayType&&d.forEach(function(a,d){b.support.audio[a]=c.canPlayType(e[d]),b.support.audio[a]&&(b.support.audio.preferred=a)})}(this,this.j5g3);